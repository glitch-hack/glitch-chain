<html>
	<head>
		<title> glitch-chain client </title>
			<script src="js/glitch-canvas.js"> </script>

			<script type="text/javascript" src="js/buffer.js"></script>
    	<script type="text/javascript" src="js/bitcoinjs.min.js"></script>
    	<script type="text/javascript" src="js/block_utils.js"></script>
			<script type="text/javascript" src="js/glitch-canvas.js"> </script>

			<link rel="stylesheet" type="text/css" href="css/style.css">
	</head>

	<body>
		<div id="main-wrapper">
		<h1> Glitch-Client </h1>
			<canvas id="glitch-canvas-1" class="glitch-canvas" style="border:1px solid #000000;"> </canvas>


			<img id="glitch-image" src="images/test.jpg"> </img>

			<div id="toolpanel">
				<ul id="parameter-list">
					<li>
						<p>Amount</p>
						<div id="amountValue">50</div>
					</li>

					<li>
						<p>Seed</p>
						<div id="seedValue">50</div>
					</li>

					<li>
						<p>Iterations</p>
						<div id="iterationsValue">50</div>
					</li>

					<li>
						<p>Quality</p>
						<div id="qualityValue">50</div>
					</li>

					<li>
						<p>Difference</p>
						<div id="differenceValue"></div>
					</li>

					<li>
						<div class="verticalButtons" style="margin-top: 29px">
						  <button id="glitch-button" class="action-button"> Glitch </button>
						</div>
					</li>
				</ul>
			</div>
		 <canvas id="glitch-canvas-2" class="glitch-canvas" style="border:1px solid #000000;"> </canvas>
			<canvas id="glitch-canvas-3" class="glitch-canvas" style="border:1px solid #000000;"> </canvas>
			<canvas id="glitch-canvas-4" class="glitch-canvas" style="border:1px solid #000000;"> </canvas>

			<p id="output"> </p>



		</div>

		</div>


		<script>

    var sourceImage = document.getElementById('glitch-image');
		var originalCanvas = document.getElementById('glitch-canvas-1');
		var canvas2 = document.getElementById('glitch-canvas-2');
		var canvas3 = document.getElementById('glitch-canvas-3');
		var canvas4 = document.getElementById('glitch-canvas-4');

		function glitchClicked(){
	 			tryGlitch(10);
		}

		function tryGlitch(repetitions)
		{
			var arrayOut = [];
			var diff = null;
			var parameters = null;

			for(x = 0; x < repetitions; x++)
			{
				parameters = getRandomParameters();
				doGlitch(originalCanvas, parameters);
			  diff = compare(originalCanvas, canvas2);
				arrayOut.push(diff);
				alert(diff);
			}
			console.log(arrayOut);
		}


		function getRandomParameters(){
			var amountValue = Math.floor((Math.random() * 100) + 1);
			var seedValue = Math.floor((Math.random() * 100) + 1);
			var iterationsValue = Math.floor((Math.random() * 100) + 1);
			var qualityValue = Math.floor((Math.random() * 100) + 1);

			return {
				amount: amountValue,
				seed: seedValue,
				iterations: iterationsValue,
				quality: qualityValue };
		}

		function drawImage(image, canvas){
			var context = canvas.getContext('2d');
			context.drawImage(source, 0, 0);
		}

		function doGlitch(canvas, parameters) {
			console.log("do glitch:", parameters)
			var context = canvas.getContext('2d');
			var imageData = context.getImageData(0, 0, canvas.clientWidth, canvas.clientHeight);

			function drawGlitchedImageData(image_data) {
		  	context.putImageData(image_data, 0, 0);
			}

			glitch(imageData, parameters, drawGlitchedImageData);
		}

		function setOriginalImage(canvas){
			var ctx = canvas.getContext('2d');
			ctx.drawImage(sourceImage, 0, 0);
		}

		function copyCanvas(originalCanvas, targetCanvas){
			var context = targetCanvas.getContext('2d');
			targetCanvas.drawImage(originalCanvas, 0, 0);
		}

			window.addEventListener("load", function() {
				 // Get elements
				 var glitchButton = document.getElementById('glitch-button');
				 var parameters1 = getRandomParameters();

				 setOriginalImage(originalCanvas);
				 setOriginalImage(canvas2);
				 setOriginalImage(canvas3);

				 //doGlitch(originalCanvas);

				 doGlitch(canvas2, parameters1);

				 glitchButton.addEventListener('click', glitchClicked);

			});


        // for testing only
        getTransactions('1HnhWpkMHMjgt167kvgcPyurMmsCQ2WPgg', parseParams);

		</script>


	</body>
</html>
